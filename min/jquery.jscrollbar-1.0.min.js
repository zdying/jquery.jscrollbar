/**
 * User: daiying.zhang
 * Date: 13-4-14
 * Time: 下午2:37
 * Email:97532151@qq.com
 * Site: http://sanjh.cn
 */
(function(b){b.fn.jscrollbar=function(d){var f={color:"black",width:12,opacity:0.6,position:"outer",keyControl:true,mouseScrollDirection:"vertical"},c="jscrollbar",e=this.data(c);if(typeof d==="string"){if(e){if(d==="getObject"){return e;}else{if(e[d]){e[d].apply(e,Array.prototype.slice.call(arguments,1));}return this;}}else{throw new Error("This object is not available!");}}return this.each(function(){var g=new a(b(this),b.extend({},f,d));b(this).data(c,g);});};function a(d,e){this.obj=d;this.opts=e;var i=this;l();this.width=d.width();this.height=d.height();this.scrollWidth=d[0].scrollWidth;this.scrollHeight=d[0].scrollHeight;this.barXWidth=Math.min(this.width-this.opts.width-10,Math.max(10,this.width*this.width/this.scrollWidth));this.barYHeight=Math.min(this.height-this.opts.width-10,Math.max(10,this.height*this.height/this.scrollHeight));this.$sbContent=n();this.contentScrollHeight=this.$sbContent[0].scrollHeight;this.barX=undefined;this.barY=undefined;this.barXmaxX=0;this.barYmaxY=0;this.barXB=null;this.barYB=null;m();c();f();k();function n(){i.obj.css({overflow:"hidden"}).wrapInner('<div class="sb-Content" style="overflow:hidden;"></div>');var o=i.obj.children(".sb-Content").scrollTop(0).scrollLeft(0);if(b.browser.mozilla){b(document).ready(function(){o.scrollTop(0);});}return o;}function g(q){var o=i.opts.color,p=i.opts.width;if(/x/i.test(q)){i.barXB=b('<div style="position:absolute;font-size:0;background:'+o+";opacity:0.2;filter:alpha(opacity=20);width:"+i.width+"px;height:"+p+'px;left:0;bottom:0;"></div>').appendTo(i.obj).bind("mousedown",function(r){var s=Math.max(Math.min(r.pageX-b(this).offset().left-i.barX.width()/2,i.barXmaxX),0);i.barX.stop().animate({left:s},300);i._updateContentLoc({direction:"x",barXLocLeft:s,duration:300});return false;});}if(/y/i.test(q)){i.barYB=b('<div style="font-size:0;position:absolute;background:'+o+";opacity:0.2;filter:alpha(opacity=20);width:"+p+"px;height:"+i.height+'px;right:0;top:0"></div>').appendTo(i.obj).bind("mousedown",function(s){var r=Math.max(Math.min(s.pageY-b(this).offset().top-i.barY.height()/2,i.barYmaxY),0);i.barY.stop().animate({top:r},300);i._updateContentLoc({direction:"y",barYLocTop:r,duration:300});return false;});}}function k(){i.obj.mousewheel&&(i.obj.mousewheel(function(q){var t={horizontal:"x",vertical:"y"},o=(q<0?1:-1)*20,r=i.opts.mouseScrollDirection,s=i.opts.showXBar,p=i.opts.showYBar;if(r=="horizontal"&&!s&&p){r="vertical";}if(r=="vertical"&&!p&&s){r="horizontal";}i.scrollBy(t[r],o);}));}function l(){var o=i.obj.css({overflow:"auto"}).css("position");if(/(static)/ig.test(o)){i.obj.css({position:"relative"});}}function j(s){var r=i.opts.width,o=i.opts.position,t={},p=i.opts.opacity,q='<div class="jq-scrollbar" style="font-size:0;border-radius:6px;background:'+i.opts.color+";position:absolute;z-index:1;opacity:"+p+";filter:alpha(opacity="+p*100+");";if(/x/i.test(s)){i.opts.showXBar=true;i.barX=this.barX=b(q+"bottom:0;left:0;width:"+i.barXWidth+"px;height:"+r+'px;"></div>').appendTo(i.obj);if(o==="outer"){t.height=(i.height-r)+"px";g("x");}else{t.height=i.height+"px";}}else{if(/y/i.test(s)){i.opts.showYBar=true;i.barY=b(q+";right:0;top:0;width:"+r+"px;height:"+i.barYHeight+'px;"></div>').appendTo(i.obj);if(o==="outer"){t.width=(i.width-r)+"px";g("y");}else{t.width=i.width+"px";}}}i.$sbContent.css(t);}function h(o){if(/x/i.test(o)&&i.barX){i.barX.jqdrag({type:"x",maxX:i.barXmaxX,minX:0,ondrag:function(){i._updateContentLoc({direction:"x"});}});}if(/y/.test(o)&&i.barY){i.barY.jqdrag({type:"y",maxY:i.barYmaxY,minY:0,ondrag:function(){i._updateContentLoc({direction:"y"});}});}}function m(){var p=i.opts.showXBar;var o=i.opts.showYBar;if((p!==false)&&(i.scrollWidth>i.width)){j("x");if((o!==false)&&(i.contentScrollHeight>i.$sbContent.height())){j("y");}}if((o!==false)&&(typeof i.barY==="undefined")&&(i.scrollHeight>i.height)){j("y");if((p!==false)&&(typeof i.barX==="undefined")&&(i.$sbContent[0].scrollWidth>i.$sbContent.width())){j("x");}}if(!e.showYBar){i.$sbContent.css({width:i.width+"px"});}if(!e.showXBar){i.$sbContent.css({height:i.height+"px"});}i.barX&&(i.barXmaxX=i.width-i.barX.width()-((e.position==="inner"||!i.opts.showYBar)?0:i.opts.width));i.barY&&(i.barYmaxY=i.height-i.barY.height()-((e.position==="inner"||!i.opts.showXBar)?0:i.opts.width));h("xy");}function c(){var p=i.opts.position,q=i.opts.opacity,r={opacity:0},o={opacity:q};if(p==="outer"){}else{var s=i.obj.find(".jq-scrollbar").animate(r,1000);i.obj.hover(function(){s.stop().animate(o,500);},function(){s.stop().animate(r,1000);});}}function f(){if(i.opts.keyControl){i.$sbContent.hover(function(){b(document).bind("keydown.jsb",function(p){var o=p.keyCode;switch(o){case 37:i.scrollBy("x",-20);break;case 38:i.scrollBy("y",-20);break;case 39:i.scrollBy("x",20);break;case 40:i.scrollBy("y",20);break;}/(37|38|39|40)/.test(o)&&p.preventDefault();});},function(){b(document).unbind("keydown.jsb");});}}}a.prototype={getPosition:function(d){var c=this.barX?Math.max(0,Math.min(parseInt(this.barX.css("left"))+(d||0),this.barXmaxX)):0,e=this.barY?Math.max(0,Math.min(parseInt(this.barY.css("top"))+(d||0),this.barYmaxY)):0;return{x:c,y:e};},scrollBy:function(e,c){!e&&(e="y");!c&&(c=10);var d=this.$sbContent;c=Math.round(e==="x"?(this.width-this.barXWidth)*c/(d[0].scrollWidth-d.width()):(this.height-this.barYHeight)*c/(d[0].scrollHeight-d.height()));var f=this.getPosition(c);if(this.barX&&e=="x"){this.barX.css({left:f.x+"px"});this._updateContentLoc({direction:"x"});}else{if(this.barY&&e=="y"){this.barY.css({top:f.y+"px"});this._updateContentLoc({direction:"y"});}}return this;},scrollTo:function(d,c){this.scrollBy(d,c-(d=="x"?this.$sbContent.scrollLeft():this.$sbContent.scrollTop()));return this;},updateUI:function(){this.scrollWidth=this.$sbContent[0].scrollWidth;this.scrollHeight=this.$sbContent[0].scrollHeight;this.barXWidth=Math.min(this.width-this.opts.width-10,Math.max(10,this.width*this.width/this.scrollWidth));this.barYHeight=Math.min(this.height-this.opts.width-10,Math.max(10,this.height*this.height/this.scrollHeight));this.contentScrollHeight=this.$sbContent[0].scrollHeight;if(this.barX){this.barX.css({width:this.barXWidth});this.barXmaxX=this.width-this.barXWidth-((this.opts.position==="inner"||!this.opts.showYBar)?0:this.opts.width);this.barX.jqdrag("setOption",{maxX:this.barXmaxX});}if(this.barY){this.barY.css({height:this.barYHeight});this.barYmaxY=this.height-this.barY.height()-((this.opts.position==="inner"||!this.opts.showXBar)?0:this.opts.width);this.barX.jqdrag("setOption",{maxY:this.barYmaxY});}return this;},_updateContentLoc:function(e){var e=b.extend({direction:"xy",duration:0},e),h=e.direction,j=e.barXLocLeft,d=e.barYLocTop,c=typeof j==="undefined",i=typeof d==="undefined",g=e.duration,f=this.$sbContent;if(/y/.test(h)&&this.barY){f.stop().animate({scrollTop:(f[0].scrollHeight-f.height())*(!i?d:parseInt(this.barY.css("top")))/this.barYmaxY},g);}if(/x/.test(h)&&this.barX){f.stop().animate({scrollLeft:(f[0].scrollWidth-f.width())*(!c?j:parseInt(this.barX.css("left")))/this.barXmaxX},g);}}};})(jQuery);